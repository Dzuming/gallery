{"filter":false,"title":"connect.php","tooltip":"/model/connect.php","ace":{"folds":[],"customSyntax":"php","scrolltop":0,"scrollleft":0,"selection":{"start":{"row":16,"column":16},"end":{"row":16,"column":33},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"hash":"ec3f18d40c2662e9fd1835acf0027737d06d48b4","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":13,"column":7},"end":{"row":13,"column":8},"action":"insert","lines":["h"],"id":89}],[{"start":{"row":25,"column":0},"end":{"row":28,"column":5},"action":"insert","lines":["catch (PDOException $e) {","        print \"Error!: \" . $e->getMessage() . \"<br/>\";","        die();","    }"],"id":90}],[{"start":{"row":29,"column":2},"end":{"row":30,"column":0},"action":"insert","lines":["",""],"id":91}],[{"start":{"row":30,"column":0},"end":{"row":39,"column":32},"action":"insert","lines":["<?php"," ","//db connection class using singleton pattern","class dbConn{"," ","//variable to hold connection object.","protected static $db;"," ","//private construct - class cannot be instatiated externally.","private function __construct() {"],"id":92}],[{"start":{"row":39,"column":32},"end":{"row":40,"column":0},"action":"insert","lines":["",""],"id":93},{"start":{"row":40,"column":0},"end":{"row":40,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":40,"column":4},"end":{"row":44,"column":1},"action":"insert","lines":["try {","// assign PDO object to db variable","self::$db = new PDO( 'mysql:host=localhost;dbname=DBNAME', 'USERNAME', 'PASSWORD' );","self::$db->setAttribute( PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION );","}"],"id":94}],[{"start":{"row":13,"column":7},"end":{"row":13,"column":8},"action":"remove","lines":["h"],"id":95}],[{"start":{"row":13,"column":4},"end":{"row":13,"column":104},"action":"remove","lines":["$db = new PDO('mysql:host='.$servername.';port='.$dbport.';dbname='.$database,$username, $password);"],"id":96}],[{"start":{"row":42,"column":6},"end":{"row":42,"column":83},"action":"remove","lines":["$db = new PDO( 'mysql:host=localhost;dbname=DBNAME', 'USERNAME', 'PASSWORD' )"],"id":97},{"start":{"row":42,"column":6},"end":{"row":42,"column":106},"action":"insert","lines":["$db = new PDO('mysql:host='.$servername.';port='.$dbport.';dbname='.$database,$username, $password);"]}],[{"start":{"row":42,"column":105},"end":{"row":42,"column":106},"action":"remove","lines":[";"],"id":98}],[{"start":{"row":44,"column":1},"end":{"row":45,"column":0},"action":"insert","lines":["",""],"id":99}],[{"start":{"row":45,"column":0},"end":{"row":45,"column":1},"action":"insert","lines":["}"],"id":100}],[{"start":{"row":45,"column":1},"end":{"row":46,"column":0},"action":"insert","lines":["",""],"id":101}],[{"start":{"row":46,"column":0},"end":{"row":46,"column":1},"action":"insert","lines":["}"],"id":102}],[{"start":{"row":44,"column":1},"end":{"row":45,"column":0},"action":"insert","lines":["",""],"id":103}],[{"start":{"row":45,"column":0},"end":{"row":67,"column":2},"action":"insert","lines":["catch (PDOException $e) {","//Output error - would normally log this to error file rather than output to user.","echo \"Connection Error: \" . $e->getMessage();","}"," ","}"," ","// get connection function. Static method - accessible without instantiation","public static function getConnection() {"," ","//Guarantees single instance, if no connection object exists then create one.","if (!self::$db) {","//new connection object.","new dbConn();","}"," ","//return connection.","return self::$db;","}"," ","}//end class"," ","?>"],"id":104}],[{"start":{"row":68,"column":0},"end":{"row":68,"column":1},"action":"remove","lines":["}"],"id":105}],[{"start":{"row":69,"column":0},"end":{"row":69,"column":1},"action":"remove","lines":["}"],"id":106}],[{"start":{"row":11,"column":2},"end":{"row":29,"column":2},"action":"remove","lines":["  try","{","    ","$stmt = $dbh->prepare(\"CALL getname()\");","","        // call the stored procedure","        $stmt->execute();","","        echo \"<B>outputting...</B><BR>\";","        while ($rs = $stmt->fetch(PDO::FETCH_OBJ)) {","            echo \"output: \".$rs->name.\"<BR>\";","        }","        echo \"<BR><B>\".date(\"r\").\"</B>\";","}","catch (PDOException $e) {","        print \"Error!: \" . $e->getMessage() . \"<br/>\";","        die();","    }","?>"],"id":107}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":5},"action":"remove","lines":["<?php"],"id":108}],[{"start":{"row":0,"column":0},"end":{"row":3,"column":75},"action":"remove","lines":["","    // A simple PHP script demonstrating how to connect to MySQL.","    // Press the 'Run' button on the top to start the web server,","    // then click the URL that is emitted to the Output tab of the console."],"id":109}],[{"start":{"row":2,"column":3},"end":{"row":6,"column":19},"action":"remove","lines":[" $servername = getenv('IP');","    $username = getenv('C9_USER');","    $password = \"\";","    $database = \"photos\";","    $dbport = 3306;"],"id":110}],[{"start":{"row":14,"column":32},"end":{"row":15,"column":0},"action":"insert","lines":["",""],"id":112},{"start":{"row":15,"column":0},"end":{"row":15,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":15,"column":4},"end":{"row":19,"column":19},"action":"insert","lines":[" $servername = getenv('IP');","    $username = getenv('C9_USER');","    $password = \"\";","    $database = \"photos\";","    $dbport = 3306;"],"id":113}],[{"start":{"row":8,"column":6},"end":{"row":8,"column":12},"action":"remove","lines":["dbConn"],"id":134},{"start":{"row":8,"column":6},"end":{"row":8,"column":7},"action":"insert","lines":["D"]}],[{"start":{"row":8,"column":7},"end":{"row":8,"column":8},"action":"insert","lines":["B"],"id":135}],[{"start":{"row":38,"column":4},"end":{"row":38,"column":10},"action":"remove","lines":["dbConn"],"id":136},{"start":{"row":38,"column":4},"end":{"row":38,"column":5},"action":"insert","lines":["D"]}],[{"start":{"row":38,"column":5},"end":{"row":38,"column":6},"action":"insert","lines":["B"],"id":137}],[{"start":{"row":22,"column":104},"end":{"row":22,"column":105},"action":"insert","lines":[","],"id":138}],[{"start":{"row":22,"column":105},"end":{"row":22,"column":106},"action":"insert","lines":[" "],"id":139}],[{"start":{"row":22,"column":106},"end":{"row":22,"column":161},"action":"insert","lines":["array(PDO::MYSQL_ATTR_INIT_COMMAND => \"SET NAMES utf8\")"],"id":140}],[{"start":{"row":44,"column":1},"end":{"row":45,"column":0},"action":"insert","lines":["",""],"id":152},{"start":{"row":45,"column":0},"end":{"row":45,"column":1},"action":"insert","lines":[" "]}],[{"start":{"row":47,"column":1},"end":{"row":85,"column":12},"action":"insert","lines":["class DB{"," ","//variable to hold connection object.","protected static $db;"," ","//private construct - class cannot be instatiated externally.","private function __construct() {","     $servername = getenv('IP');","    $username = getenv('C9_USER');","    $password = \"\";","    $database = \"photos\";","    $dbport = 3306;","    try {","// assign PDO object to db variable","self::$db = new PDO('mysql:host='.$servername.';port='.$dbport.';dbname='.$database,$username, $password, array(PDO::MYSQL_ATTR_INIT_COMMAND => \"SET NAMES utf8\"));","self::$db->setAttribute( PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION );","}","catch (PDOException $e) {","//Output error - would normally log this to error file rather than output to user.","echo \"Connection Error: \" . $e->getMessage();","}"," ","}"," ","// get connection function. Static method - accessible without instantiation","public static function getConnection() {"," ","//Guarantees single instance, if no connection object exists then create one.","if (!self::$db) {","//new connection object.","new DB();","}"," ","//return connection.","return self::$db;","}"," "," ","}//end class"],"id":154}],[{"start":{"row":47,"column":7},"end":{"row":47,"column":9},"action":"remove","lines":["DB"],"id":155},{"start":{"row":47,"column":7},"end":{"row":47,"column":8},"action":"insert","lines":["f"]}],[{"start":{"row":47,"column":8},"end":{"row":47,"column":9},"action":"insert","lines":["t"],"id":156}],[{"start":{"row":47,"column":9},"end":{"row":47,"column":10},"action":"insert","lines":["p"],"id":157}],[{"start":{"row":50,"column":17},"end":{"row":50,"column":20},"action":"remove","lines":["$db"],"id":158},{"start":{"row":50,"column":17},"end":{"row":50,"column":18},"action":"insert","lines":["f"]}],[{"start":{"row":50,"column":18},"end":{"row":50,"column":19},"action":"insert","lines":["t"],"id":159}],[{"start":{"row":50,"column":19},"end":{"row":50,"column":20},"action":"insert","lines":["p"],"id":160}],[{"start":{"row":50,"column":17},"end":{"row":50,"column":18},"action":"insert","lines":["$"],"id":161}],[{"start":{"row":54,"column":5},"end":{"row":58,"column":19},"action":"remove","lines":["$servername = getenv('IP');","    $username = getenv('C9_USER');","    $password = \"\";","    $database = \"photos\";","    $dbport = 3306;"],"id":162},{"start":{"row":54,"column":5},"end":{"row":56,"column":60},"action":"insert","lines":["$ftp_server = \"ftp.example.com\";","$ftp_conn = ftp_connect($ftp_server) or die(\"Could not connect to $ftp_server\");","$login = ftp_login($ftp_conn, $ftp_username, $ftp_userpass);"]}],[{"start":{"row":55,"column":0},"end":{"row":56,"column":60},"action":"remove","lines":["$ftp_conn = ftp_connect($ftp_server) or die(\"Could not connect to $ftp_server\");","$login = ftp_login($ftp_conn, $ftp_username, $ftp_userpass);"],"id":163}],[{"start":{"row":58,"column":0},"end":{"row":59,"column":69},"action":"remove","lines":["self::$db = new PDO('mysql:host='.$servername.';port='.$dbport.';dbname='.$database,$username, $password, array(PDO::MYSQL_ATTR_INIT_COMMAND => \"SET NAMES utf8\"));","self::$db->setAttribute( PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION );"],"id":164},{"start":{"row":58,"column":0},"end":{"row":59,"column":60},"action":"insert","lines":["$ftp_conn = ftp_connect($ftp_server) or die(\"Could not connect to $ftp_server\");","$login = ftp_login($ftp_conn, $ftp_username, $ftp_userpass);"]}],[{"start":{"row":58,"column":37},"end":{"row":58,"column":79},"action":"remove","lines":["or die(\"Could not connect to $ftp_server\")"],"id":165}],[{"start":{"row":58,"column":36},"end":{"row":58,"column":37},"action":"remove","lines":[" "],"id":166}],[{"start":{"row":58,"column":0},"end":{"row":58,"column":37},"action":"remove","lines":["$ftp_conn = ftp_connect($ftp_server);"],"id":167}],[{"start":{"row":54,"column":37},"end":{"row":55,"column":0},"action":"insert","lines":["",""],"id":168},{"start":{"row":55,"column":0},"end":{"row":55,"column":5},"action":"insert","lines":["     "]}],[{"start":{"row":55,"column":5},"end":{"row":55,"column":42},"action":"insert","lines":["$ftp_conn = ftp_connect($ftp_server);"],"id":169}],[{"start":{"row":60,"column":0},"end":{"row":60,"column":1},"action":"insert","lines":["s"],"id":170}],[{"start":{"row":60,"column":1},"end":{"row":60,"column":2},"action":"insert","lines":["e"],"id":171}],[{"start":{"row":60,"column":2},"end":{"row":60,"column":3},"action":"insert","lines":["l"],"id":172}],[{"start":{"row":60,"column":3},"end":{"row":60,"column":4},"action":"insert","lines":["f"],"id":173}],[{"start":{"row":60,"column":4},"end":{"row":60,"column":5},"action":"insert","lines":[":"],"id":174}],[{"start":{"row":60,"column":5},"end":{"row":60,"column":6},"action":"insert","lines":[":"],"id":175}],[{"start":{"row":60,"column":7},"end":{"row":60,"column":12},"action":"remove","lines":["login"],"id":176},{"start":{"row":60,"column":7},"end":{"row":60,"column":8},"action":"insert","lines":["f"]}],[{"start":{"row":60,"column":8},"end":{"row":60,"column":9},"action":"insert","lines":["t"],"id":177}],[{"start":{"row":60,"column":9},"end":{"row":60,"column":10},"action":"insert","lines":["p"],"id":178}],[{"start":{"row":60,"column":0},"end":{"row":60,"column":6},"action":"remove","lines":["self::"],"id":179}],[{"start":{"row":56,"column":0},"end":{"row":56,"column":1},"action":"insert","lines":["}"],"id":180}],[{"start":{"row":56,"column":1},"end":{"row":57,"column":0},"action":"insert","lines":["",""],"id":181}],[{"start":{"row":57,"column":0},"end":{"row":57,"column":1},"action":"insert","lines":["p"],"id":182}],[{"start":{"row":57,"column":1},"end":{"row":57,"column":2},"action":"insert","lines":["u"],"id":183}],[{"start":{"row":57,"column":2},"end":{"row":57,"column":3},"action":"insert","lines":["b"],"id":184}],[{"start":{"row":57,"column":3},"end":{"row":57,"column":4},"action":"insert","lines":["l"],"id":185}],[{"start":{"row":57,"column":4},"end":{"row":57,"column":5},"action":"insert","lines":["i"],"id":186}],[{"start":{"row":57,"column":5},"end":{"row":57,"column":6},"action":"insert","lines":["c"],"id":187}],[{"start":{"row":57,"column":6},"end":{"row":57,"column":7},"action":"insert","lines":[" "],"id":188}],[{"start":{"row":57,"column":7},"end":{"row":57,"column":8},"action":"insert","lines":["f"],"id":189}],[{"start":{"row":57,"column":8},"end":{"row":57,"column":9},"action":"insert","lines":["u"],"id":190}],[{"start":{"row":57,"column":9},"end":{"row":57,"column":10},"action":"insert","lines":["n"],"id":191}],[{"start":{"row":57,"column":10},"end":{"row":57,"column":11},"action":"insert","lines":["c"],"id":192}],[{"start":{"row":57,"column":11},"end":{"row":57,"column":12},"action":"insert","lines":["t"],"id":193}],[{"start":{"row":57,"column":12},"end":{"row":57,"column":13},"action":"insert","lines":["i"],"id":194}],[{"start":{"row":57,"column":13},"end":{"row":57,"column":14},"action":"insert","lines":["o"],"id":195}],[{"start":{"row":57,"column":14},"end":{"row":57,"column":15},"action":"insert","lines":["n"],"id":196}],[{"start":{"row":57,"column":15},"end":{"row":57,"column":16},"action":"insert","lines":[" "],"id":197}],[{"start":{"row":57,"column":16},"end":{"row":57,"column":17},"action":"insert","lines":["c"],"id":198}],[{"start":{"row":57,"column":17},"end":{"row":57,"column":18},"action":"insert","lines":["o"],"id":199}],[{"start":{"row":57,"column":18},"end":{"row":57,"column":19},"action":"insert","lines":["n"],"id":200}],[{"start":{"row":57,"column":19},"end":{"row":57,"column":20},"action":"insert","lines":["n"],"id":201}],[{"start":{"row":57,"column":20},"end":{"row":57,"column":21},"action":"insert","lines":["e"],"id":202}],[{"start":{"row":57,"column":21},"end":{"row":57,"column":22},"action":"insert","lines":["c"],"id":203}],[{"start":{"row":57,"column":22},"end":{"row":57,"column":23},"action":"insert","lines":["t"],"id":204}],[{"start":{"row":57,"column":23},"end":{"row":57,"column":24},"action":"insert","lines":[" "],"id":205}],[{"start":{"row":57,"column":24},"end":{"row":57,"column":25},"action":"insert","lines":["{"],"id":206}],[{"start":{"row":57,"column":23},"end":{"row":57,"column":25},"action":"insert","lines":["()"],"id":207}],[{"start":{"row":54,"column":4},"end":{"row":56,"column":1},"action":"remove","lines":[" $ftp_server = \"ftp.example.com\";","     $ftp_conn = ftp_connect($ftp_server);","}"],"id":208},{"start":{"row":54,"column":4},"end":{"row":56,"column":32},"action":"insert","lines":["private $connectionId;","private $loginOk = false;","private $messageArray = array();"]}],[{"start":{"row":54,"column":4},"end":{"row":56,"column":32},"action":"remove","lines":["private $connectionId;","private $loginOk = false;","private $messageArray = array();"],"id":209}],[{"start":{"row":50,"column":22},"end":{"row":51,"column":0},"action":"remove","lines":["",""],"id":210},{"start":{"row":50,"column":22},"end":{"row":52,"column":32},"action":"insert","lines":["private $connectionId;","private $loginOk = false;","private $messageArray = array();"]}],[{"start":{"row":54,"column":32},"end":{"row":55,"column":0},"action":"insert","lines":["",""],"id":211},{"start":{"row":55,"column":0},"end":{"row":55,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":55,"column":4},"end":{"row":56,"column":0},"action":"insert","lines":["",""],"id":212},{"start":{"row":56,"column":0},"end":{"row":56,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":56,"column":4},"end":{"row":56,"column":5},"action":"insert","lines":["}"],"id":213},{"start":{"row":56,"column":0},"end":{"row":56,"column":4},"action":"remove","lines":["    "]}],[{"start":{"row":57,"column":0},"end":{"row":57,"column":4},"action":"remove","lines":["    "],"id":214}],[{"start":{"row":56,"column":1},"end":{"row":57,"column":0},"action":"remove","lines":["",""],"id":215}],[{"start":{"row":57,"column":0},"end":{"row":81,"column":1},"action":"remove","lines":["public function connect() {","    try {","// assign PDO object to db variable","","$ftp = ftp_login($ftp_conn, $ftp_username, $ftp_userpass);","}","catch (PDOException $e) {","//Output error - would normally log this to error file rather than output to user.","echo \"Connection Error: \" . $e->getMessage();","}"," ","}"," ","// get connection function. Static method - accessible without instantiation","public static function getConnection() {"," ","//Guarantees single instance, if no connection object exists then create one.","if (!self::$db) {","//new connection object.","new DB();","}"," ","//return connection.","return self::$db;","}"],"id":216},{"start":{"row":57,"column":0},"end":{"row":60,"column":1},"action":"insert","lines":["private function logMessage($message) ","{","    $this->messageArray[] = $message;","}"]}],[{"start":{"row":61,"column":1},"end":{"row":64,"column":1},"action":"insert","lines":["public function getMessages()","{","    return $this->messageArray;","}"],"id":217}],[{"start":{"row":61,"column":0},"end":{"row":61,"column":1},"action":"remove","lines":[" "],"id":218}],[{"start":{"row":65,"column":1},"end":{"row":87,"column":1},"action":"insert","lines":["public function connect ($server, $ftpUser, $ftpPassword, $isPassive = false)","{"," ","    // *** Set up basic connection","    $this->connectionId = ftp_connect($server);"," ","    // *** Login with username and password","    $loginResult = ftp_login($this->connectionId, $ftpUser, $ftpPassword);"," ","    // *** Sets passive mode on/off (default off)","    ftp_pasv($this->connectionId, $isPassive);"," ","    // *** Check connection","    if ((!$this->connectionId) || (!$loginResult)) {","        $this->logMessage('FTP connection has failed!');","        $this->logMessage('Attempted to connect to ' . $server . ' for user ' . $ftpUser, true);","        return false;","    } else {","        $this->logMessage('Connected to ' . $server . ', for user ' . $ftpUser);","        $this->loginOk = true;","        return true;","    }","}"],"id":219}],[{"start":{"row":50,"column":0},"end":{"row":50,"column":21},"action":"remove","lines":["protected static $ftp"],"id":220}],[{"start":{"row":50,"column":0},"end":{"row":50,"column":1},"action":"remove","lines":[";"],"id":221}],[{"start":{"row":47,"column":0},"end":{"row":88,"column":12},"action":"remove","lines":[" class ftp{"," ","//variable to hold connection object.","private $connectionId;","private $loginOk = false;","private $messageArray = array(); ","//private construct - class cannot be instatiated externally.","private function __construct() {","    ","}","private function logMessage($message) ","{","    $this->messageArray[] = $message;","}","public function getMessages()","{","    return $this->messageArray;","}"," public function connect ($server, $ftpUser, $ftpPassword, $isPassive = false)","{"," ","    // *** Set up basic connection","    $this->connectionId = ftp_connect($server);"," ","    // *** Login with username and password","    $loginResult = ftp_login($this->connectionId, $ftpUser, $ftpPassword);"," ","    // *** Sets passive mode on/off (default off)","    ftp_pasv($this->connectionId, $isPassive);"," ","    // *** Check connection","    if ((!$this->connectionId) || (!$loginResult)) {","        $this->logMessage('FTP connection has failed!');","        $this->logMessage('Attempted to connect to ' . $server . ' for user ' . $ftpUser, true);","        return false;","    } else {","        $this->logMessage('Connected to ' . $server . ', for user ' . $ftpUser);","        $this->loginOk = true;","        return true;","    }","}","}//end class"],"id":223}]]},"timestamp":1456494783000}